{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "payment-hooks",
  "title": "PowerTranz payment hooks",
  "description": "Hooks and route handlers for PowerTranz payment flows.",
  "files": [
    {
      "path": "registry/new-york/payment-hooks/components/hooks/use-powertranz.ts",
      "type": "registry:file",
      "target": "components/hooks/use-powertranz.ts",
      "content": "import axios from \"axios\";\nimport { useState } from \"react\";\n\nexport type AuthAndCaptureFlowProps = {\n  orderId: string;\n  amount: number;\n  siteRoot: string;\n  transactionIdentifier: string;\n  token: string;\n  email: string;\n  authOnly?: boolean;\n};\n\ntype CardAuthFlowProps = {\n  orderId: string;\n  amount: number;\n  siteRoot: string;\n  transactionIdentifier: string;\n  cardNumber: string;\n  expiration: string;\n  cvv: string;\n  cardholderName: string;\n};\n\nexport type TokenizeCardProps = {\n  cardNumber: string;\n  expirationYear: string; // YY\n  expirationMonth: string; // MM\n  cvv: string;\n  cardholderName: string;\n  currencyCode?: string;\n};\n\ntype TokenizeCardResponse = {\n  TransactionType: number;\n  TotalAmount: number;\n  Approved: boolean;\n  TransactionIdentifier: string;\n  IsoResponseCode: string;\n  PanToken?: string;\n  ResponseMessage: string;\n  OrderIdentifier: string;\n  Errors?: [{ Code: string; Message: string }];\n  CardBrand?: string;\n  CurrencyCode?: string;\n};\n\nexport type CapturePaymentProps = {\n  transactionIdentifier: string;\n  amount: number;\n};\n\nexport type CapturePaymentResponse = {\n  OriginalTrxnIdentifier: string;\n  TransactionType: number;\n  Approved: boolean;\n  TransactionIdentifier: string;\n  TotalAmount: number;\n  CurrencyCode: string;\n  RRN: string;\n  IsoResponseCode: string;\n  ResponseMessage: string;\n  OrderIdentifier: string;\n};\n\nconst usePowertranz = () => {\n  const [loading, setLoading] = useState(false);\n\n  // Load FAC Auth (and Capture) Flow\n  const loadPowertranzAuthAndCaptureFlow = async ({\n    orderId,\n    amount,\n    siteRoot,\n    transactionIdentifier,\n    token,\n    email,\n    authOnly = false,\n  }: AuthAndCaptureFlowProps) => {\n    // Only attempt to load HPP if in browser, and not when SSR is running\n    if (!siteRoot) {\n      throw new Error(\"Running in SSR mode\");\n    }\n    let config = {\n      method: \"post\",\n      url: `/api/powertranz/auth`,\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\",\n      },\n      data: {\n        orderId,\n        amount,\n        siteRoot,\n        transactionIdentifier,\n        token,\n        email,\n        authOnly,\n      },\n    };\n    setLoading(true);\n    const response = await axios(config); // api call to fetch fac hosted page html\n    setLoading(false);\n    console.log(\"@loadPowertranzAuthAndCaptureFlow response: \");\n    console.log(response.data);\n    if (response.data.ResponseMessage === \"Duplicate transaction\") {\n      console.error(\n        \"This checkout has already been processed. Please go back and try your order again.\"\n      );\n      throw new Error(\"Duplicate transaction\");\n    }\n\n    return response.data.RedirectData;\n  };\n\n  // Load FAC Zero Dollar Auth Flow\n  const loadPowertranzCardAuthFlow = async ({\n    orderId,\n    amount,\n    siteRoot,\n    transactionIdentifier,\n    cardNumber,\n    expiration,\n    cvv,\n    cardholderName,\n  }: CardAuthFlowProps) => {\n    console.log({ orderId, amount, siteRoot });\n    // Only attempt to load HPP if in browser, and not when SSR is running\n    if (!siteRoot) {\n      throw new Error(\"Running in SSR mode\");\n    }\n    let config = {\n      method: \"post\",\n      url: `/api/powertranz/zero-dollar-auth`,\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\",\n      },\n      data: {\n        orderId,\n        amount,\n        siteRoot,\n        transactionIdentifier,\n        cardNumber,\n        expiration,\n        cvv,\n        cardholderName,\n      },\n    };\n    setLoading(true);\n    const response = await axios(config); // api call to fetch fac hosted page html\n    setLoading(false);\n    console.log(response.data);\n    if (response.data.ResponseMessage === \"Duplicate transaction\") {\n      console.error(\n        \"This checkout has already been processed. Please go back and try your order again.\"\n      );\n      throw new Error(\"Duplicate transaction\");\n    }\n\n    // console.log(`Axios Response: ${stringify(response.data)}`); // data property of axios response object\n    // console.log(`Axios Status: ${stringify(response.status)}`); // status property of axios response object\n    return response.data.RedirectData;\n  };\n\n  // Tokenize a Card\n  const tokenizeCard = async ({\n    cardNumber,\n    expirationYear,\n    expirationMonth,\n    cvv,\n    cardholderName,\n    currencyCode,\n  }: TokenizeCardProps): Promise<TokenizeCardResponse> => {\n    try {\n      setLoading(true);\n      const response = await axios.post(\"/api/powertranz/tokenize\", {\n        cardNumber,\n        expirationYear,\n        expirationMonth,\n        cvv,\n        cardholderName,\n        currencyCode,\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Tokenization error:\", error);\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const capturePayment = async ({\n    transactionIdentifier,\n    amount,\n  }: CapturePaymentProps): Promise<CapturePaymentResponse> => {\n    try {\n      setLoading(true);\n      const response = await axios.post(\"/api/powertranz/capture\", {\n        transactionIdentifier,\n        amount,\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Tokenization error:\", error);\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    loadPowertranzAuthAndCaptureFlow,\n    loadPowertranzCardAuthFlow,\n    tokenizeCard,\n    capturePayment,\n    loading,\n  };\n};\nexport default usePowertranz;\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/auth/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/auth/route.ts",
      "content": "import { AuthAndCaptureFlowProps } from \"@/components/hooks/use-powertranz\";\nimport axios from \"axios\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(request: Request) {\n  const data = (await request.json()) as AuthAndCaptureFlowProps;\n  const {\n    siteRoot,\n    token,\n    amount,\n    orderId,\n    transactionIdentifier,\n    email,\n    authOnly,\n  } = data;\n  console.log({\n    amount,\n    token,\n    orderId,\n    transactionIdentifier,\n    email,\n    authOnly,\n  });\n\n  // build authorization request\n  const authWithTokenizeRequest = {\n    TransactionIdentifier: transactionIdentifier,\n    TotalAmount: Number(amount),\n    CurrencyCode: \"780\", //TTD code\n    ThreeDSecure: true,\n    FraudCheck: true,\n    OrderIdentifier: orderId,\n    Source: {\n      Token: token,\n    },\n    BillingAddress: {\n      EmailAddress: email,\n    },\n    ExtendedData: {\n      ThreeDSecure: {\n        ChallengeWindowSize: 4,\n        ChallengeIndicator: \"01\",\n      },\n      MerchantResponseUrl: `${siteRoot}/api/powertranz/${\n        authOnly ? \"auth-response\" : \"response\"\n      }`,\n    },\n  };\n\n  const config = {\n    method: \"post\",\n    url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/spi/auth`,\n    headers: {\n      \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n      \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    },\n    data: authWithTokenizeRequest,\n  };\n\n  try {\n    const authWithTokenResponse = await axios(config);\n    console.log(\"authWithTokenResponse response: \", authWithTokenResponse.data);\n    return NextResponse.json(authWithTokenResponse.data);\n  } catch (error) {\n    console.log(`PowerTranz ERROR: ${error}`);\n    // Return a new error response\n    return NextResponse.error();\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/auth-response/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/auth-response/route.ts",
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Set CORS headers\n    const headers = {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n    };\n\n    // PowerTranz sends form-encoded data, not JSON\n    const formData = await request.formData();\n    const responseData = formData.get(\"Response\") as string;\n\n    console.log(\"fac response (raw):\", responseData);\n\n    const authResponse = JSON.parse(responseData);\n    console.log(\"auth response: \", authResponse);\n\n    let error = null;\n\n    // We will allow transactions with IsoResponseCode 3D0 and 3D1 to pass through.\n    // 3D1 means that the cardholder's payment method does not support 3DSecure Authentication\n    if (\n      authResponse.IsoResponseCode === \"3D0\" ||\n      authResponse.IsoResponseCode === \"3D1\"\n    ) {\n      let config: {\n        method: string;\n        url: string;\n        headers: any;\n        data: string | Object;\n      } = {\n        method: \"post\",\n        url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/spi/payment`,\n        headers: {\n          \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n          \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        },\n        data: JSON.stringify(authResponse.SpiToken),\n      };\n\n      const paymentResult = await axios(config);\n      const paymentResponse = paymentResult.data;\n      console.log(\"payment response:\", paymentResponse);\n\n      if (paymentResponse.IsoResponseCode === \"00\") {\n        const urlParams = new URLSearchParams({\n          isSuccess: \"1\",\n          order_id: authResponse.OrderIdentifier,\n          amount: paymentResponse.TotalAmount,\n          txn_type: \"capture\",\n          responseCode: paymentResponse.IsoResponseCode,\n          responseMessage: paymentResponse.ResponseMessage || \"\",\n          referenceNumber: paymentResponse.RRN || \"\",\n          transactionIdentifier: paymentResponse.TransactionIdentifier || \"\",\n        });\n        const paymentCompleteUrl = `/response?${urlParams.toString()}`;\n        console.log(\"Redirecting to success URL:\", paymentCompleteUrl);\n\n        // Get the origin from the request\n        const origin = new URL(request.url).origin;\n        const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n        console.log(\"Full redirect URL:\", fullRedirectUrl);\n\n        return NextResponse.redirect(fullRedirectUrl, {\n          status: 302,\n          headers,\n        });\n      } else {\n        error = {\n          txnType: \"payment\",\n          code: paymentResponse.IsoResponseCode,\n          message: paymentResponse.ResponseMessage,\n          additionalErrors: paymentResponse.Errors || null,\n        };\n      }\n    } else {\n      error = {\n        txnType: \"auth\",\n        code: authResponse.IsoResponseCode,\n        message: authResponse.ResponseMessage,\n        additionalErrors: authResponse.Errors || null,\n      };\n    }\n\n    const errorParams = new URLSearchParams({\n      isSuccess: \"0\",\n      order_id: authResponse.OrderIdentifier || \"\",\n      txn_type: error?.txnType || \"\",\n      responseCode: error?.code || \"\",\n      responseMessage: error?.message || \"\",\n      type: \"Online Credit/Debit Card\",\n    });\n\n    if (error?.additionalErrors) {\n      errorParams.append(\"errors\", JSON.stringify(error.additionalErrors));\n    }\n\n    const paymentCompleteUrl = `/response?${errorParams.toString()}`;\n    console.log(\"Redirecting to error URL:\", paymentCompleteUrl);\n\n    const origin = new URL(request.url).origin;\n    const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n    console.log(\"Full error redirect URL:\", fullRedirectUrl);\n\n    return NextResponse.redirect(fullRedirectUrl, {\n      status: 302,\n      headers,\n    });\n  } catch (error: any) {\n    console.log(`FAC Get HPP Result ERROR: ${error}`);\n    const catchErrorParams = new URLSearchParams({\n      isSuccess: \"2\",\n      errors: error.message || \"Unknown error occurred\",\n      type: \"Online Credit/Debit Card\",\n    });\n    const paymentCompleteUrl = `/response?${catchErrorParams.toString()}`;\n    console.log(\"Redirecting to catch error URL:\", paymentCompleteUrl);\n\n    const origin = new URL(request.url).origin;\n    const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n    console.log(\"Full catch error redirect URL:\", fullRedirectUrl);\n\n    return NextResponse.redirect(fullRedirectUrl, {\n      status: 302,\n      headers: {\n        \"Access-Control-Allow-Origin\": \"*\",\n      },\n    });\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/capture/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/capture/route.ts",
      "content": "import axios from \"axios\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(request: Request) {\n  // Set CORS headers\n  const headers = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n  };\n  const data = await request.json();\n  const { transactionIdentifier, amount } = data;\n  console.log({\n    transactionIdentifier,\n    amount,\n  });\n\n  const config: {\n    method: string;\n    url: string;\n    headers: any;\n    data: string | Object;\n  } = {\n    method: \"post\",\n    url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/capture`,\n    headers: {\n      \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n      \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    },\n    data: {\n      TransactionIdentifier: transactionIdentifier,\n      TotalAmount: Number(amount),\n    },\n  };\n\n  try {\n    const captureResult = await axios(config);\n    const captureResponse = captureResult.data;\n    console.log(\"capture response:\", captureResponse);\n\n    return NextResponse.json(captureResponse);\n  } catch (error) {\n    console.log(`PowerTranz ERROR: ${error}`);\n    // Return a new error response\n    return NextResponse.error();\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/refund/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/refund/route.ts",
      "content": "import axios from \"axios\";\nimport { NextResponse } from \"next/server\";\n\nexport const dynamic = \"force-dynamic\"; // defaults to force-static\nexport async function POST(request: Request, response: Response) {\n  const data = await request.json();\n  const { transactionIdentifier, amount } = data;\n  console.log({\n    amount,\n    transactionIdentifier,\n  });\n\n  // build refund request\n  const refundRequest = {\n    Refund: true,\n    TransactionIdentifier: transactionIdentifier, // transaction id that needed to refund\n    TotalAmount: Number(amount), //Amount to be refunded\n    CurrencyCode: \"780\", //TTD code\n  };\n\n  const config = {\n    method: \"post\",\n    url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/refund`,\n    headers: {\n      \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n      \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    },\n    data: refundRequest,\n  };\n\n  try {\n    const refundResponse = await axios(config);\n    console.log(\"refund response: \", refundResponse.data);\n    return NextResponse.json(refundResponse.data);\n  } catch (error) {\n    console.log(`PowerTranz ERROR: ${error}`);\n    // Return a new error response\n    return NextResponse.error();\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/response/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/response/route.ts",
      "content": "import { NextRequest, NextResponse } from \"next/server\";\nimport axios from \"axios\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Set CORS headers\n    const headers = {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n    };\n\n    // PowerTranz sends form-encoded data, not JSON\n    const formData = await request.formData();\n    const responseData = formData.get(\"Response\") as string;\n\n    console.log(\"fac response (raw):\", responseData);\n\n    const authResponse = JSON.parse(responseData);\n    console.log(\"auth response: \", authResponse);\n\n    let error = null;\n\n    // We will allow transactions with IsoResponseCode 3D0 and 3D1 to pass through.\n    // 3D1 means that the cardholder's payment method does not support 3DSecure Authentication\n    if (\n      authResponse.IsoResponseCode === \"3D0\" ||\n      authResponse.IsoResponseCode === \"3D1\"\n    ) {\n      let config: {\n        method: string;\n        url: string;\n        headers: any;\n        data: string | Object;\n      } = {\n        method: \"post\",\n        url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/spi/payment`,\n        headers: {\n          \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n          \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n          \"Content-Type\": \"application/json; charset=utf-8\",\n        },\n        data: JSON.stringify(authResponse.SpiToken),\n      };\n\n      console.log(\"powetranz payment config\", config);\n\n      const paymentResult = await axios(config);\n      const paymentResponse = paymentResult.data;\n      console.log(\"payment response:\", paymentResponse);\n\n      if (paymentResponse.IsoResponseCode === \"00\") {\n        config.url = `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/capture`;\n        config.data = {\n          transactionIdentifier: paymentResponse.TransactionIdentifier,\n          totalAmount: paymentResponse.TotalAmount,\n        };\n        console.log(\"powetranz capture config\", config);\n\n        const captureResult = await axios(config);\n        const captureResponse = captureResult.data;\n        console.log(\"capture response:\", captureResponse);\n\n        if (captureResponse.IsoResponseCode === \"00\") {\n          const urlParams = new URLSearchParams({\n            isSuccess: \"1\",\n            order_id: authResponse.OrderIdentifier,\n            txn_type: \"capture\",\n            responseCode: captureResponse.IsoResponseCode,\n            responseMessage: captureResponse.ResponseMessage || \"\",\n            referenceNumber: captureResponse.RRN || \"\",\n            transactionIdentifier: paymentResponse.TransactionIdentifier || \"\",\n          });\n          const paymentCompleteUrl = `/response?${urlParams.toString()}`;\n          console.log(\"Redirecting to success URL:\", paymentCompleteUrl);\n\n          // Get the origin from the request\n          const origin = new URL(request.url).origin;\n          const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n          console.log(\"Full redirect URL:\", fullRedirectUrl);\n\n          // TODO: Complete the order, or do whatever success logic you want here\n\n          return NextResponse.redirect(fullRedirectUrl, {\n            status: 302,\n            headers,\n          });\n        } else {\n          error = {\n            txnType: \"capture\",\n            code: captureResponse.IsoResponseCode,\n            message: captureResponse.ResponseMessage,\n            additionalErrors: captureResponse.Errors || null,\n          };\n        }\n      } else {\n        error = {\n          txnType: \"payment\",\n          code: paymentResponse.IsoResponseCode,\n          message: paymentResponse.ResponseMessage,\n          additionalErrors: paymentResponse.Errors || null,\n        };\n      }\n    } else {\n      error = {\n        txnType: \"auth\",\n        code: authResponse.IsoResponseCode,\n        message: authResponse.ResponseMessage,\n        additionalErrors: authResponse.Errors || null,\n      };\n    }\n\n    const errorParams = new URLSearchParams({\n      isSuccess: \"0\",\n      order_id: authResponse.OrderIdentifier || \"\",\n      txn_type: error?.txnType || \"\",\n      responseCode: error?.code || \"\",\n      responseMessage: error?.message || \"\",\n      type: \"Online Credit/Debit Card\",\n    });\n\n    if (error?.additionalErrors) {\n      errorParams.append(\"errors\", JSON.stringify(error.additionalErrors));\n    }\n\n    const paymentCompleteUrl = `/response?${errorParams.toString()}`;\n    console.log(\"Redirecting to error URL:\", paymentCompleteUrl);\n\n    const origin = new URL(request.url).origin;\n    const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n    console.log(\"Full error redirect URL:\", fullRedirectUrl);\n\n    return NextResponse.redirect(fullRedirectUrl, {\n      status: 302,\n      headers,\n    });\n  } catch (error: any) {\n    console.log(`FAC Get HPP Result ERROR: ${error}`);\n    const catchErrorParams = new URLSearchParams({\n      isSuccess: \"2\",\n      errors: error.message || \"Unknown error occurred\",\n      type: \"Online Credit/Debit Card\",\n    });\n    const paymentCompleteUrl = `/response?${catchErrorParams.toString()}`;\n    console.log(\"Redirecting to catch error URL:\", paymentCompleteUrl);\n\n    const origin = new URL(request.url).origin;\n    const fullRedirectUrl = `${origin}${paymentCompleteUrl}`;\n    console.log(\"Full catch error redirect URL:\", fullRedirectUrl);\n\n    return NextResponse.redirect(fullRedirectUrl, {\n      status: 302,\n      headers: {\n        \"Access-Control-Allow-Origin\": \"*\",\n      },\n    });\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/tokenize/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/tokenize/route.ts",
      "content": "import axios from \"axios\";\nimport { NextResponse } from \"next/server\";\nimport { TokenizeCardProps } from \"@/components/hooks/use-powertranz\";\n\nexport async function POST(request: Request) {\n  const data = (await request.json()) as TokenizeCardProps;\n  const {\n    cardNumber,\n    cvv,\n    expirationYear,\n    expirationMonth,\n    cardholderName,\n    currencyCode = \"780\", // TTD code\n  } = data;\n  console.log({\n    cardNumber,\n    cvv,\n    expirationYear,\n    expirationMonth,\n    cardholderName,\n    currencyCode,\n  });\n\n  // Generate a UUID for the transaction identifier and orderId\n  const transactionIdentifier = crypto.randomUUID();\n  const orderId = crypto.randomUUID();\n\n  // Format the expiration date, the /tokenize endpoint expects YYMM\n  const expiration = `${expirationYear}${expirationMonth}`;\n\n  // build tokenize request\n  const tokenizeRequest = {\n    AddressMatch: false,\n    CurrencyCode: currencyCode,\n    TransactionIdentifier: transactionIdentifier,\n    TotalAmount: Number(0),\n    Tokenize: true,\n    ThreeDSecure: false,\n    OrderIdentifier: orderId,\n    Source: {\n      CardPan: cardNumber,\n      CardCvv: cvv,\n      CardExpiration: expiration,\n      CardholderName: cardholderName,\n    },\n  };\n\n  const config = {\n    method: \"post\",\n    url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/riskmgmt`,\n    headers: {\n      \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n      \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    },\n    data: tokenizeRequest,\n  };\n\n  try {\n    const tokenizeResponse = await axios(config);\n    console.log(\"tokenize response: \", tokenizeResponse.data);\n    return NextResponse.json(tokenizeResponse.data);\n  } catch (error) {\n    console.log(`PowerTranz ERROR: ${error}`);\n    // Return a new error response\n    return NextResponse.error();\n  }\n}\n"
    },
    {
      "path": "registry/new-york/payment-hooks/app/api/powertranz/zero-dollar-auth/route.ts",
      "type": "registry:file",
      "target": "app/api/powertranz/zero-dollar-auth/route.ts",
      "content": "import axios from \"axios\";\nimport { NextResponse } from \"next/server\";\n\nexport const dynamic = \"force-dynamic\"; // defaults to force-static\n\nexport async function POST(request: Request) {\n  const data = await request.json();\n  const {\n    siteRoot,\n    cardNumber,\n    amount,\n    cvv = \"123\",\n    expiration = \"2505\",\n    cardholderName = \"John Baker\",\n    orderId,\n    transactionIdentifier,\n  } = data;\n  console.log({\n    amount,\n    cardNumber,\n    cvv,\n    expiration,\n    cardholderName,\n    orderId,\n    transactionIdentifier,\n  });\n\n  // build authorization request\n  const authWithTokenizeRequest = {\n    TransactionIdentifier: transactionIdentifier,\n    TotalAmount: Number(amount),\n    CurrencyCode: \"780\", //TTD code\n    ThreeDSecure: true,\n    FraudCheck: true,\n    OrderIdentifier: orderId,\n    Source: {\n      CardPan: cardNumber,\n      CardCvv: cvv,\n      CardExpiration: expiration,\n      CardholderName: cardholderName,\n    },\n    ExtendedData: {\n      ThreeDSecure: {\n        ChallengeWindowSize: 4,\n        ChallengeIndicator: \"01\",\n      },\n      MerchantResponseUrl: `${siteRoot}/api/powertranz/hpp-result`,\n    },\n  };\n\n  const config = {\n    method: \"post\",\n    url: `${process.env.NEXT_PUBLIC_FAC_PTRANZ_BASE_URL}/spi/auth`,\n    headers: {\n      \"PowerTranz-PowerTranzId\": process.env.FAC_MERCHANT_ID,\n      \"PowerTranz-PowerTranzPassword\": process.env.FAC_PROCESSING_PASS,\n      \"Content-Type\": \"application/json; charset=utf-8\",\n    },\n    data: authWithTokenizeRequest,\n  };\n\n  try {\n    const authWithTokenResponse = await axios(config);\n    console.log(\"authWithTokenResponse response: \", authWithTokenResponse.data);\n    return NextResponse.json(authWithTokenResponse.data);\n  } catch (error) {\n    console.log(`PowerTranz ERROR: ${error}`);\n    // Return a new error response\n    return NextResponse.error();\n  }\n}\n"
    }
  ],
  "type": "registry:block"
}
