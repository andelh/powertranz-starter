{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "payment-hooks",
  "title": "PowerTranz payment hooks",
  "description": "Hooks for PowerTranz payment flows.",
  "files": [
    {
      "path": "registry/new-york/payment-hooks/components/hooks/use-powertranz.ts",
      "type": "registry:file",
      "target": "components/hooks/use-powertranz.ts",
      "content": "import axios from \"axios\";\nimport { useState } from \"react\";\n\nexport type AuthAndCaptureFlowProps = {\n  orderId: string;\n  amount: number;\n  siteRoot: string;\n  transactionIdentifier: string;\n  token: string;\n  email: string;\n  authOnly?: boolean;\n};\n\ntype CardAuthFlowProps = {\n  orderId: string;\n  amount: number;\n  siteRoot: string;\n  transactionIdentifier: string;\n  cardNumber: string;\n  expiration: string;\n  cvv: string;\n  cardholderName: string;\n};\n\nexport type TokenizeCardProps = {\n  cardNumber: string;\n  expirationYear: string; // YY\n  expirationMonth: string; // MM\n  cvv: string;\n  cardholderName: string;\n  currencyCode?: string;\n};\n\ntype TokenizeCardResponse = {\n  TransactionType: number;\n  TotalAmount: number;\n  Approved: boolean;\n  TransactionIdentifier: string;\n  IsoResponseCode: string;\n  PanToken?: string;\n  ResponseMessage: string;\n  OrderIdentifier: string;\n  Errors?: [{ Code: string; Message: string }];\n  CardBrand?: string;\n  CurrencyCode?: string;\n};\n\nexport type CapturePaymentProps = {\n  transactionIdentifier: string;\n  amount: number;\n};\n\nexport type CapturePaymentResponse = {\n  OriginalTrxnIdentifier: string;\n  TransactionType: number;\n  Approved: boolean;\n  TransactionIdentifier: string;\n  TotalAmount: number;\n  CurrencyCode: string;\n  RRN: string;\n  IsoResponseCode: string;\n  ResponseMessage: string;\n  OrderIdentifier: string;\n};\n\nconst usePowertranz = () => {\n  const [loading, setLoading] = useState(false);\n\n  // Load FAC Auth (and Capture) Flow\n  const loadPowertranzAuthAndCaptureFlow = async ({\n    orderId,\n    amount,\n    siteRoot,\n    transactionIdentifier,\n    token,\n    email,\n    authOnly = false,\n  }: AuthAndCaptureFlowProps) => {\n    // Only attempt to load HPP if in browser, and not when SSR is running\n    if (!siteRoot) {\n      throw new Error(\"Running in SSR mode\");\n    }\n    let config = {\n      method: \"post\",\n      url: `/api/powertranz/auth`,\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\",\n      },\n      data: {\n        orderId,\n        amount,\n        siteRoot,\n        transactionIdentifier,\n        token,\n        email,\n        authOnly,\n      },\n    };\n    setLoading(true);\n    const response = await axios(config); // api call to fetch fac hosted page html\n    setLoading(false);\n    console.log(\"@loadPowertranzAuthAndCaptureFlow response: \");\n    console.log(response.data);\n    if (response.data.ResponseMessage === \"Duplicate transaction\") {\n      console.error(\n        \"This checkout has already been processed. Please go back and try your order again.\"\n      );\n      throw new Error(\"Duplicate transaction\");\n    }\n\n    return response.data.RedirectData;\n  };\n\n  // Load FAC Zero Dollar Auth Flow\n  const loadPowertranzCardAuthFlow = async ({\n    orderId,\n    amount,\n    siteRoot,\n    transactionIdentifier,\n    cardNumber,\n    expiration,\n    cvv,\n    cardholderName,\n  }: CardAuthFlowProps) => {\n    console.log({ orderId, amount, siteRoot });\n    // Only attempt to load HPP if in browser, and not when SSR is running\n    if (!siteRoot) {\n      throw new Error(\"Running in SSR mode\");\n    }\n    let config = {\n      method: \"post\",\n      url: `/api/powertranz/zero-dollar-auth`,\n      headers: {\n        \"Content-Type\": \"application/json; charset=utf-8\",\n      },\n      data: {\n        orderId,\n        amount,\n        siteRoot,\n        transactionIdentifier,\n        cardNumber,\n        expiration,\n        cvv,\n        cardholderName,\n      },\n    };\n    setLoading(true);\n    const response = await axios(config); // api call to fetch fac hosted page html\n    setLoading(false);\n    console.log(response.data);\n    if (response.data.ResponseMessage === \"Duplicate transaction\") {\n      console.error(\n        \"This checkout has already been processed. Please go back and try your order again.\"\n      );\n      throw new Error(\"Duplicate transaction\");\n    }\n\n    // console.log(`Axios Response: ${stringify(response.data)}`); // data property of axios response object\n    // console.log(`Axios Status: ${stringify(response.status)}`); // status property of axios response object\n    return response.data.RedirectData;\n  };\n\n  // Tokenize a Card\n  const tokenizeCard = async ({\n    cardNumber,\n    expirationYear,\n    expirationMonth,\n    cvv,\n    cardholderName,\n    currencyCode,\n  }: TokenizeCardProps): Promise<TokenizeCardResponse> => {\n    try {\n      setLoading(true);\n      const response = await axios.post(\"/api/powertranz/tokenize\", {\n        cardNumber,\n        expirationYear,\n        expirationMonth,\n        cvv,\n        cardholderName,\n        currencyCode,\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Tokenization error:\", error);\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const capturePayment = async ({\n    transactionIdentifier,\n    amount,\n  }: CapturePaymentProps): Promise<CapturePaymentResponse> => {\n    try {\n      setLoading(true);\n      const response = await axios.post(\"/api/powertranz/capture\", {\n        transactionIdentifier,\n        amount,\n      });\n      return response.data;\n    } catch (error) {\n      console.error(\"Tokenization error:\", error);\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return {\n    loadPowertranzAuthAndCaptureFlow,\n    loadPowertranzCardAuthFlow,\n    tokenizeCard,\n    capturePayment,\n    loading,\n  };\n};\nexport default usePowertranz;\n"
    }
  ],
  "type": "registry:block"
}
